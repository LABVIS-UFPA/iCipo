<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard ‚Ä¢  iCip√≥</title>
    <link rel="stylesheet" href="dashboard.css" />
  </head>
  <body>
    <div class="app">
      
      <aside class="sidebar">
        <div class="brand">
          <div class="logo">iCip√≥</div>
          <div>
            <div class="brandTitle">Dashboard</div>
            <div class="brandSub" id="brandSub">‚Äî</div>
          </div>
        </div>

        <nav class="nav">
          <button class="navBtn active" data-view="overview">üìå Vis√£o geral</button>
          <button class="navBtn" data-view="categories">üé® Categorias</button>
          <button class="navBtn" data-view="papers">üìö Artigos</button>
          <button class="navBtn" data-view="iterations">üîÅ Itera√ß√µes</button>
          <button class="navBtn" data-view="criteria">‚úÖ Crit√©rios</button>
          <button class="navBtn" data-view="citations">üîó Conex√µes</button>
          <button class="navBtn" data-view="graph">üï∏Ô∏è Grafo</button>
          <button class="navBtn" data-view="insights">‚ú® Insights</button>
        </nav>

        <div class="sideFooter">
          <button id="btnProjects" class="ghost">üìÅ Projetos</button>
          <button id="btnOptions" class="ghost">‚öôÔ∏è Configura√ß√µes</button>
          <div class="hint">Dica: marque artigos no Scholar com bot√£o direito ‚Üí ‚ÄúMarcar link‚Äù ‚Üí categoria.</div>
        </div>
      </aside>

      <main class="main">
        <header class="topbar">
          <div class="topLeft">
            <h1 id="projectTitle">Projeto</h1>
            <div class="meta" id="projectMeta">‚Äî</div>
          </div>
        </header>

        <!-- OVERVIEW -->
        <section class="view" id="view_overview">
          <div class="kpiGrid">
            <div class="kpi"><div class="kpiLabel">Total</div><div class="kpiVal" id="kpi_total">0</div></div>
            <div class="kpi"><div class="kpiLabel">Inclu√≠dos</div><div class="kpiVal" id="kpi_included">0</div></div>
            <div class="kpi"><div class="kpiLabel">Exclu√≠dos</div><div class="kpiVal" id="kpi_excluded">0</div></div>
            <div class="kpi"><div class="kpiLabel">Pendentes</div><div class="kpiVal" id="kpi_pending">0</div></div>
            <div class="kpi"><div class="kpiLabel">Duplicados</div><div class="kpiVal" id="kpi_duplicate">0</div></div>
            <div class="kpi"><div class="kpiLabel">Seeds</div><div class="kpiVal" id="kpi_seed">0</div></div>
          </div>

          <div class="grid2">
            <div class="card">
              <div class="cardTitle">Status dos artigos</div>
              <div id="statusBars" class="bars"></div>
            </div>
            <div class="card">
              <div class="cardTitle">Publica√ß√µes por ano</div>
              <svg id="timeline" width="100%" height="180" role="img" aria-label="Histograma por ano"></svg>
            </div>
          </div>

          <div class="grid2">
            <div class="card">
              <div class="cardTitle">Fluxo (PRISMA adaptado)</div>
              <div id="flow" class="flow"></div>
            </div>
            <div class="card">
              <div class="cardTitle">Pendentes recentes</div>
              <div class="tableWrap">
                <table class="table" id="pendingTable">
                  <thead><tr><th>T√≠tulo</th><th>Origem</th><th>Iter.</th><th>A√ß√µes</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- PAPERS -->
        <section class="view hidden" id="view_papers">
          <div class="toolbar">
            <input id="search" class="input" placeholder="Buscar por t√≠tulo, autor, tag‚Ä¶" />
            <select id="f_status" class="select">
              <option value="all">Status: todos</option>
              <option value="pending">Pendentes</option>
              <option value="included">Inclu√≠dos</option>
              <option value="excluded">Exclu√≠dos</option>
              <option value="duplicate">Duplicados</option>
            </select>
            <select id="f_origin" class="select">
              <option value="all">Origem: todas</option>
              <option value="seed">Seed</option>
              <option value="backward">Backward</option>
              <option value="forward">Forward</option>
              <option value="unknown">Desconhecida</option>
            </select>
            <select id="f_iteration" class="select">
              <option value="all">Itera√ß√£o: todas</option>
            </select>

            <div class="menu" id="downloadCitationsMenu">
              <button id="btnDownloadCitations" class="btn">‚¨áÔ∏è Download Citations</button>
              <div id="downloadCitationsPanel" class="menuPanel" aria-label="Menu de Download Citations">
                <button class="menuItem" data-format="bibtex">BibTeX (.bib)</button>
                <button class="menuItem" data-format="abnt">ABNT (texto)</button>
                <button class="menuItem" data-format="apa">APA (texto)</button>
                <button class="menuItem" data-format="endnote">EndNote / RIS (.ris)</button>
              </div>
            </div>

            <button id="btnBulkInclude" class="btn">Incluir</button>
            <button id="btnBulkExclude" class="btn">Excluir</button>
            <button id="btnBulkPending" class="btn">Pendente</button>
            <button id="btnBulkDuplicate" class="btn">Duplicado</button>
            <button id="btnBulkDeleteMarked" class="btn">Remover marcado</button>
          </div>

          <div class="tableWrap">
            <table class="table" id="papersTable">
              <thead>
                <tr>
                  <th style="width:36px"><input type="checkbox" id="checkAll" /></th>
                  <th>T√≠tulo</th>
                  <th style="width:72px">Ano</th>
                  <th style="width:110px">Origem</th>
                  <th style="width:90px">Iter.</th>
                  <th style="width:110px">Status</th>
                  <th style="width:140px">Crit√©rio</th>
                  <th style="width:160px">Tags</th>
                  <th style="width:90px">Link</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <!-- ITERATIONS -->
        <section class="view hidden" id="view_iterations">
          <div class="card">
            <div class="cardTitle">Itera√ß√µes</div>
            <div class="row">
              <input id="newIterId" class="input" placeholder="Ex.: I2" style="max-width:140px" />
              <select id="newIterMode" class="select" style="max-width:220px">
                <option value="seed">Seed</option>
                <option value="backward">Backward</option>
                <option value="forward">Forward</option>
                <option value="both">Backward + Forward</option>
              </select>
              <button id="btnAddIteration" class="btn">Adicionar</button>
              <button id="btnSetCurrentIteration" class="btn">Definir como atual</button>
            </div>
            <div class="tableWrap">
              <table class="table" id="iterationsTable">
                <thead><tr><th>ID</th><th>Tipo</th><th>Modo</th><th>Criada em</th><th>A√ß√µes</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- CRITERIA -->
        <section class="view hidden" id="view_criteria">
          <div class="grid2">
            <div class="card">
              <div class="cardTitle">Cadastrar crit√©rios</div>
              <div class="row">
                <input id="critId" class="input" placeholder="Ex.: C1" style="max-width:120px" />
                <input id="critDesc" class="input" placeholder="Descri√ß√£o do crit√©rio" />
                <button id="btnAddCriterion" class="btn">Salvar</button>
              </div>
              <div class="tableWrap">
                <table class="table" id="criteriaTable">
                  <thead><tr><th>ID</th><th>Descri√ß√£o</th><th>Qtd.</th><th>A√ß√µes</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="card">
              <div class="cardTitle">Exclu√≠dos (audit√°vel)</div>
              <div class="tableWrap">
                <table class="table" id="excludedTable">
                  <thead><tr><th>T√≠tulo</th><th>Crit√©rio</th><th>Iter.</th><th>Link</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- CITATIONS -->
        <section class="view hidden" id="view_citations">
          <div class="card">
            <div class="cardTitle">Criar conex√£o (manual)</div>
            <div class="row">
              <select id="c_from" class="select"></select>
              <select id="c_type" class="select" style="max-width:200px">
                <option value="backward">Backward (refer√™ncia)</option>
                <option value="forward">Forward (cita√ß√£o)</option>
              </select>
              <select id="c_to" class="select"></select>
              <button id="btnAddCitation" class="btn">Adicionar</button>
            </div>
            <div class="tableWrap">
              <table class="table" id="citationsTable">
                <thead><tr><th>De</th><th>Tipo</th><th>Para</th><th>A√ß√µes</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- GRAPH -->
        <section class="view hidden" id="view_graph">
          <div class="grid2">
            <div class="card">
              <div class="cardTitle">Grafo de cita√ß√µes (simples, offline)</div>
              <div class="row">
                <select id="g_filterIteration" class="select" style="max-width:220px"></select>
                <select id="g_filterStatus" class="select" style="max-width:220px">
                  <option value="all">Status: todos</option>
                  <option value="pending">Pendentes</option>
                  <option value="included">Inclu√≠dos</option>
                  <option value="excluded">Exclu√≠dos</option>
                  <option value="duplicate">Duplicados</option>
                </select>
                <button id="btnGraphReset" class="btn">Recalcular layout</button>
              </div>
              <svg id="graph" width="100%" height="520" role="img" aria-label="Grafo"></svg>
              <div class="hint">Dica: clique em um n√≥ para abrir o link. O grafo usa as conex√µes criadas na aba ‚ÄúConex√µes‚Äù.</div>
            </div>
            <div class="card">
              <div class="cardTitle">Detalhes</div>
              <div id="graphDetails" class="details">Selecione um n√≥‚Ä¶</div>
            </div>
          </div>
        </section>

        <!-- INSIGHTS -->
        <section class="view hidden" id="view_insights">
          <div class="grid2">
            <div class="card">
              <div class="cardTitle">Resumo autom√°tico da revis√£o</div>
              <div class="row">
                <button id="btnGenerateSummary" class="btn">Gerar resumo</button>
                <button id="btnCopySummary" class="btn">Copiar</button>
              </div>
              <textarea id="summaryText" class="input" style="width:100%;min-height:220px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace" placeholder="Clique em 'Gerar resumo'..."></textarea>
              <div class="hint" style="margin-top:8px">Use este texto como base do relat√≥rio/TCC (ajuste conforme necess√°rio).</div>
            </div>
            <div class="card">
              <div class="cardTitle">Satura√ß√£o (alerta)</div>
              <div id="saturationBox" class="hint">‚Äî</div>
              <div class="cardTitle" style="margin-top:16px">Poss√≠veis duplicatas (sugest√£o)</div>
              <div class="row">
                <button id="btnFindDuplicates" class="btn">Detectar duplicatas</button>
                <select id="dupThreshold" class="select" style="max-width:240px">
                  <option value="0.9">Limite: 0.90 (mais r√≠gido)</option>
                  <option value="0.85" selected>Limite: 0.85 (recomendado)</option>
                  <option value="0.8">Limite: 0.80 (mais sens√≠vel)</option>
                </select>
              </div>
              <div class="tableWrap">
                <table class="table" id="dupsTable">
                  <thead><tr><th>Par sugerido</th><th>Similaridade</th><th>A√ß√µes</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:16px">
            <div class="cardTitle">Hist√≥rico (audit trail)</div>
            <div class="hint">Clique no t√≠tulo de um artigo em <b>Artigos</b> para ver o hist√≥rico aqui.</div>
            <div class="tableWrap" style="margin-top:10px">
              <table class="table" id="historyTable">
                <thead><tr><th>Quando</th><th>A√ß√£o</th><th>Detalhes</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- CATEGORIES (moved from options) -->
        <section class="view hidden" id="view_categories">
          <div class="panelHeader">
            <h2>Categorias</h2>
            <p>Crie cores para marcar artigos</p>
          </div>

          <div class="card">
            <div class="formRow">
              <div class="field">
                <label for="categoryName">Nome</label>
                <input type="text" id="categoryName" placeholder="Ex.: Seed" />
              </div>

              <div class="field fieldColor">
                <label for="categoryColor">Cor</label>
                <input type="color" id="categoryColor" />
              </div>

              <div class="field fieldActions">
                <label>&nbsp;</label>
                <div class="btnRow">
                  <button id="addCategory" class="btn primary">Adicionar</button>
                  <button id="seedDefaultCategories" class="btn">Categorias padr√£o</button>
                </div>
              </div>
            </div>

            <div class="listHead">
              <h3>Lista de categorias</h3>
              <span class="muted">Clique em <b>Excluir</b> para remover uma categoria.</span>
            </div>
            <ul id="categoryList" class="list"></ul>
          </div>
        </section>

        <!-- Documents merged into Artigos view -->

        <!-- HISTORY MODAL (fallback) -->
        <div id="historyModal" class="modal hidden" role="dialog" aria-modal="true">
          <div class="modalCard">
            <div class="row" style="justify-content:space-between;align-items:center">
              <div style="font-weight:900" id="historyModalTitle">Hist√≥rico</div>
              <button id="btnCloseHistory" class="btn">Fechar</button>
            </div>
            <div class="tableWrap" style="margin-top:10px">
              <table class="table" id="historyModalTable">
                <thead><tr><th>Quando</th><th>A√ß√£o</th><th>Detalhes</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- (removed duplicate INSIGHTS + modal) -->
      </main>

      <div id="noActiveProjectNotice" class="floatingNotice hidden" role="status" aria-live="polite">
            <div class="title">Nenhum projeto ativo</div>
            <div>Abra um projeto para carregar o dashboard. <a href="projects.html">Ir para projetos</a>.</div>
      </div>
      <div id="serverOfflineNotice" class="floatingNotice danger hidden" role="status" aria-live="polite">
        <div class="title">Sem conex√£o com o servidor</div>
        <div>Certifique-se de que o servidor est√° rodando ou verique a conex√£o em <a href="options.html">configura√ß√µes</a>.</div>
      </div>
    </div>

    <script type="module" src="dashboard.js"></script>
  </body>
</html>
